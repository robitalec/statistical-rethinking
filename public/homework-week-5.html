<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Homework: Week 5 | Learning bayesian data analysis with Statistical Rethinking</title>
  <meta name="description" content="6 Homework: Week 5 | Learning bayesian data analysis with Statistical Rethinking" />
  <meta name="generator" content="bookdown 0.22.15 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Homework: Week 5 | Learning bayesian data analysis with Statistical Rethinking" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Homework: Week 5 | Learning bayesian data analysis with Statistical Rethinking" />
  
  
  

<meta name="author" content="Alec L. Robitaille" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="homework-week-4.html"/>
<link rel="next" href="homework-week-6.html"/>
<script src="libs/header-attrs-2.9.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#links"><i class="fa fa-check"></i><b>1.1</b> Links</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#adaptations"><i class="fa fa-check"></i><b>1.1.1</b> Adaptations</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#etc"><i class="fa fa-check"></i><b>1.1.2</b> Etc</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#seed"><i class="fa fa-check"></i><b>1.2</b> Seed</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="homework-week-1.html"><a href="homework-week-1.html"><i class="fa fa-check"></i><b>2</b> Homework: Week 1</a>
<ul>
<li class="chapter" data-level="2.1" data-path="homework-week-1.html"><a href="homework-week-1.html#variables"><i class="fa fa-check"></i><b>2.1</b> Variables</a></li>
<li class="chapter" data-level="2.2" data-path="homework-week-1.html"><a href="homework-week-1.html#joint-model"><i class="fa fa-check"></i><b>2.2</b> Joint model</a></li>
<li class="chapter" data-level="2.3" data-path="homework-week-1.html"><a href="homework-week-1.html#question-1"><i class="fa fa-check"></i><b>2.3</b> Question 1</a></li>
<li class="chapter" data-level="2.4" data-path="homework-week-1.html"><a href="homework-week-1.html#question-2"><i class="fa fa-check"></i><b>2.4</b> Question 2</a></li>
<li class="chapter" data-level="2.5" data-path="homework-week-1.html"><a href="homework-week-1.html#question-3"><i class="fa fa-check"></i><b>2.5</b> Question 3</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="homework-week-2.html"><a href="homework-week-2.html"><i class="fa fa-check"></i><b>3</b> Homework: Week 2</a>
<ul>
<li class="chapter" data-level="3.1" data-path="homework-week-2.html"><a href="homework-week-2.html#question-1-1"><i class="fa fa-check"></i><b>3.1</b> Question 1</a></li>
<li class="chapter" data-level="3.2" data-path="homework-week-2.html"><a href="homework-week-2.html#question-2-1"><i class="fa fa-check"></i><b>3.2</b> Question 2</a></li>
<li class="chapter" data-level="3.3" data-path="homework-week-2.html"><a href="homework-week-2.html#homework-question-3"><i class="fa fa-check"></i><b>3.3</b> Homework: Question 3</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="homework-week-3.html"><a href="homework-week-3.html"><i class="fa fa-check"></i><b>4</b> Homework: Week 3</a>
<ul>
<li class="chapter" data-level="4.1" data-path="homework-week-3.html"><a href="homework-week-3.html#overview-1"><i class="fa fa-check"></i><b>4.1</b> Overview</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="homework-week-3.html"><a href="homework-week-3.html#setup"><i class="fa fa-check"></i><b>4.1.1</b> Setup</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="homework-week-3.html"><a href="homework-week-3.html#question-1-2"><i class="fa fa-check"></i><b>4.2</b> Question 1</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="homework-week-3.html"><a href="homework-week-3.html#workings"><i class="fa fa-check"></i><b>4.2.1</b> Workings</a></li>
<li class="chapter" data-level="4.2.2" data-path="homework-week-3.html"><a href="homework-week-3.html#model"><i class="fa fa-check"></i><b>4.2.2</b> Model</a></li>
<li class="chapter" data-level="4.2.3" data-path="homework-week-3.html"><a href="homework-week-3.html#prior-predictive-simulation"><i class="fa fa-check"></i><b>4.2.3</b> Prior predictive simulation</a></li>
<li class="chapter" data-level="4.2.4" data-path="homework-week-3.html"><a href="homework-week-3.html#paths"><i class="fa fa-check"></i><b>4.2.4</b> Paths</a></li>
<li class="chapter" data-level="4.2.5" data-path="homework-week-3.html"><a href="homework-week-3.html#interpretation"><i class="fa fa-check"></i><b>4.2.5</b> Interpretation</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="homework-week-3.html"><a href="homework-week-3.html#question-2-2"><i class="fa fa-check"></i><b>4.3</b> Question 2</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="homework-week-3.html"><a href="homework-week-3.html#paths-1"><i class="fa fa-check"></i><b>4.3.1</b> Paths</a></li>
<li class="chapter" data-level="4.3.2" data-path="homework-week-3.html"><a href="homework-week-3.html#model-1"><i class="fa fa-check"></i><b>4.3.2</b> Model</a></li>
<li class="chapter" data-level="4.3.3" data-path="homework-week-3.html"><a href="homework-week-3.html#interpretation-1"><i class="fa fa-check"></i><b>4.3.3</b> Interpretation</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="homework-week-3.html"><a href="homework-week-3.html#question-3-1"><i class="fa fa-check"></i><b>4.4</b> Question 3</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="homework-week-3.html"><a href="homework-week-3.html#paths-2"><i class="fa fa-check"></i><b>4.4.1</b> Paths</a></li>
<li class="chapter" data-level="4.4.2" data-path="homework-week-3.html"><a href="homework-week-3.html#interpretation-2"><i class="fa fa-check"></i><b>4.4.2</b> Interpretation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="homework-week-4.html"><a href="homework-week-4.html"><i class="fa fa-check"></i><b>5</b> Homework: Week 4</a>
<ul>
<li class="chapter" data-level="5.0.1" data-path="homework-week-4.html"><a href="homework-week-4.html#setup-1"><i class="fa fa-check"></i><b>5.0.1</b> Setup</a></li>
<li class="chapter" data-level="5.1" data-path="homework-week-4.html"><a href="homework-week-4.html#question-1-3"><i class="fa fa-check"></i><b>5.1</b> Question 1</a></li>
<li class="chapter" data-level="5.2" data-path="homework-week-4.html"><a href="homework-week-4.html#question-2-3"><i class="fa fa-check"></i><b>5.2</b> Question 2</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="homework-week-4.html"><a href="homework-week-4.html#dag"><i class="fa fa-check"></i><b>5.2.1</b> DAG</a></li>
<li class="chapter" data-level="5.2.2" data-path="homework-week-4.html"><a href="homework-week-4.html#data"><i class="fa fa-check"></i><b>5.2.2</b> Data</a></li>
<li class="chapter" data-level="5.2.3" data-path="homework-week-4.html"><a href="homework-week-4.html#models"><i class="fa fa-check"></i><b>5.2.3</b> Models</a></li>
<li class="chapter" data-level="5.2.4" data-path="homework-week-4.html"><a href="homework-week-4.html#interpretation-3"><i class="fa fa-check"></i><b>5.2.4</b> Interpretation</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="homework-week-4.html"><a href="homework-week-4.html#question-3-2"><i class="fa fa-check"></i><b>5.3</b> Question 3</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="homework-week-4.html"><a href="homework-week-4.html#data-1"><i class="fa fa-check"></i><b>5.3.1</b> Data</a></li>
<li class="chapter" data-level="5.3.2" data-path="homework-week-4.html"><a href="homework-week-4.html#models-1"><i class="fa fa-check"></i><b>5.3.2</b> Models</a></li>
<li class="chapter" data-level="5.3.3" data-path="homework-week-4.html"><a href="homework-week-4.html#dag-1"><i class="fa fa-check"></i><b>5.3.3</b> DAG</a></li>
<li class="chapter" data-level="5.3.4" data-path="homework-week-4.html"><a href="homework-week-4.html#interpretation-4"><i class="fa fa-check"></i><b>5.3.4</b> Interpretation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="homework-week-5.html"><a href="homework-week-5.html"><i class="fa fa-check"></i><b>6</b> Homework: Week 5</a>
<ul>
<li class="chapter" data-level="6.0.1" data-path="homework-week-5.html"><a href="homework-week-5.html#setup-2"><i class="fa fa-check"></i><b>6.0.1</b> Setup</a></li>
<li class="chapter" data-level="6.1" data-path="homework-week-5.html"><a href="homework-week-5.html#question-1-4"><i class="fa fa-check"></i><b>6.1</b> Question 1</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="homework-week-5.html"><a href="homework-week-5.html#data-2"><i class="fa fa-check"></i><b>6.1.1</b> Data</a></li>
<li class="chapter" data-level="6.1.2" data-path="homework-week-5.html"><a href="homework-week-5.html#prior-predictive-simulation-1"><i class="fa fa-check"></i><b>6.1.2</b> Prior predictive simulation</a></li>
<li class="chapter" data-level="6.1.3" data-path="homework-week-5.html"><a href="homework-week-5.html#model-2"><i class="fa fa-check"></i><b>6.1.3</b> Model</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="homework-week-5.html"><a href="homework-week-5.html#question-2-4"><i class="fa fa-check"></i><b>6.2</b> Question 2</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="homework-week-5.html"><a href="homework-week-5.html#data-3"><i class="fa fa-check"></i><b>6.2.1</b> Data</a></li>
<li class="chapter" data-level="6.2.2" data-path="homework-week-5.html"><a href="homework-week-5.html#priors"><i class="fa fa-check"></i><b>6.2.2</b> Priors</a></li>
<li class="chapter" data-level="6.2.3" data-path="homework-week-5.html"><a href="homework-week-5.html#model-3"><i class="fa fa-check"></i><b>6.2.3</b> Model</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="homework-week-5.html"><a href="homework-week-5.html#question-3-3"><i class="fa fa-check"></i><b>6.3</b> Question 3</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="homework-week-5.html"><a href="homework-week-5.html#data-4"><i class="fa fa-check"></i><b>6.3.1</b> Data</a></li>
<li class="chapter" data-level="6.3.2" data-path="homework-week-5.html"><a href="homework-week-5.html#model-4"><i class="fa fa-check"></i><b>6.3.2</b> Model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="homework-week-6.html"><a href="homework-week-6.html"><i class="fa fa-check"></i><b>7</b> Homework: Week 6</a>
<ul>
<li class="chapter" data-level="7.0.1" data-path="homework-week-6.html"><a href="homework-week-6.html#setup-3"><i class="fa fa-check"></i><b>7.0.1</b> Setup</a></li>
<li class="chapter" data-level="7.1" data-path="homework-week-6.html"><a href="homework-week-6.html#question-1-5"><i class="fa fa-check"></i><b>7.1</b> Question 1</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="homework-week-6.html"><a href="homework-week-6.html#data-5"><i class="fa fa-check"></i><b>7.1.1</b> Data</a></li>
<li class="chapter" data-level="7.1.2" data-path="homework-week-6.html"><a href="homework-week-6.html#dag-2"><i class="fa fa-check"></i><b>7.1.2</b> DAG</a></li>
<li class="chapter" data-level="7.1.3" data-path="homework-week-6.html"><a href="homework-week-6.html#priors-1"><i class="fa fa-check"></i><b>7.1.3</b> Priors</a></li>
<li class="chapter" data-level="7.1.4" data-path="homework-week-6.html"><a href="homework-week-6.html#model-5"><i class="fa fa-check"></i><b>7.1.4</b> Model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="homework-week-7.html"><a href="homework-week-7.html"><i class="fa fa-check"></i><b>8</b> Homework: Week 7</a>
<ul>
<li class="chapter" data-level="8.0.1" data-path="homework-week-7.html"><a href="homework-week-7.html#setup-4"><i class="fa fa-check"></i><b>8.0.1</b> Setup</a></li>
<li class="chapter" data-level="8.0.2" data-path="homework-week-7.html"><a href="homework-week-7.html#data-6"><i class="fa fa-check"></i><b>8.0.2</b> Data</a></li>
<li class="chapter" data-level="8.0.3" data-path="homework-week-7.html"><a href="homework-week-7.html#model-ordered-categorical-outcome"><i class="fa fa-check"></i><b>8.0.3</b> Model: ordered categorical outcome</a></li>
<li class="chapter" data-level="8.0.4" data-path="homework-week-7.html"><a href="homework-week-7.html#model-ordered-categorical-predictors"><i class="fa fa-check"></i><b>8.0.4</b> Model: ordered categorical predictors</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="lecture-01.html"><a href="lecture-01.html"><i class="fa fa-check"></i><b>9</b> Lecture 01</a>
<ul>
<li class="chapter" data-level="9.0.1" data-path="lecture-01.html"><a href="lecture-01.html#popper"><i class="fa fa-check"></i><b>9.0.1</b> Popper</a></li>
<li class="chapter" data-level="9.0.2" data-path="lecture-01.html"><a href="lecture-01.html#approach"><i class="fa fa-check"></i><b>9.0.2</b> Approach</a></li>
<li class="chapter" data-level="9.1" data-path="lecture-01.html"><a href="lecture-01.html#hypotheses---process-models---statistical-models"><i class="fa fa-check"></i><b>9.1</b> Hypotheses - Process Models - Statistical Models</a></li>
<li class="chapter" data-level="9.2" data-path="lecture-01.html"><a href="lecture-01.html#small-world-large-world"><i class="fa fa-check"></i><b>9.2</b> Small world / large world</a></li>
<li class="chapter" data-level="9.3" data-path="lecture-01.html"><a href="lecture-01.html#example-four-marbles"><i class="fa fa-check"></i><b>9.3</b> Example: four marbles</a></li>
<li class="chapter" data-level="9.4" data-path="lecture-01.html"><a href="lecture-01.html#building-a-model"><i class="fa fa-check"></i><b>9.4</b> Building a model</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="lecture-02.html"><a href="lecture-02.html"><i class="fa fa-check"></i><b>10</b> Lecture 02</a>
<ul>
<li class="chapter" data-level="10.1" data-path="lecture-02.html"><a href="lecture-02.html#joint-prior-distribution"><i class="fa fa-check"></i><b>10.1</b> Joint prior distribution</a></li>
<li class="chapter" data-level="10.2" data-path="lecture-02.html"><a href="lecture-02.html#example-inflatable-world"><i class="fa fa-check"></i><b>10.2</b> Example: inflatable world</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="lecture-02.html"><a href="lecture-02.html#design-the-model"><i class="fa fa-check"></i><b>10.2.1</b> <strong>Design the model</strong></a></li>
<li class="chapter" data-level="10.2.2" data-path="lecture-02.html"><a href="lecture-02.html#condition"><i class="fa fa-check"></i><b>10.2.2</b> <strong>Condition</strong></a></li>
<li class="chapter" data-level="10.2.3" data-path="lecture-02.html"><a href="lecture-02.html#evaluate"><i class="fa fa-check"></i><b>10.2.3</b> <strong>Evaluate</strong></a></li>
<li class="chapter" data-level="10.2.4" data-path="lecture-02.html"><a href="lecture-02.html#define-parameters"><i class="fa fa-check"></i><b>10.2.4</b> Define parameters</a></li>
<li class="chapter" data-level="10.2.5" data-path="lecture-02.html"><a href="lecture-02.html#joint-model-1"><i class="fa fa-check"></i><b>10.2.5</b> Joint model</a></li>
<li class="chapter" data-level="10.2.6" data-path="lecture-02.html"><a href="lecture-02.html#posterior"><i class="fa fa-check"></i><b>10.2.6</b> Posterior</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="lecture-02.html"><a href="lecture-02.html#grid-approximation"><i class="fa fa-check"></i><b>10.3</b> Grid approximation</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="lecture-02.html"><a href="lecture-02.html#sampling-from-the-posterior"><i class="fa fa-check"></i><b>10.3.1</b> Sampling from the posterior</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="lecture-03.html"><a href="lecture-03.html"><i class="fa fa-check"></i><b>11</b> Lecture 03</a>
<ul>
<li class="chapter" data-level="11.1" data-path="lecture-03.html"><a href="lecture-03.html#regressions"><i class="fa fa-check"></i><b>11.1</b> Regressions</a></li>
<li class="chapter" data-level="11.2" data-path="lecture-03.html"><a href="lecture-03.html#normal-distributions"><i class="fa fa-check"></i><b>11.2</b> Normal distributions</a></li>
<li class="chapter" data-level="11.3" data-path="lecture-03.html"><a href="lecture-03.html#prior-predictive-distributions"><i class="fa fa-check"></i><b>11.3</b> Prior predictive distributions</a></li>
<li class="chapter" data-level="11.4" data-path="lecture-03.html"><a href="lecture-03.html#quadratic-approximate"><i class="fa fa-check"></i><b>11.4</b> Quadratic approximate</a></li>
<li class="chapter" data-level="11.5" data-path="lecture-03.html"><a href="lecture-03.html#centering-variables"><i class="fa fa-check"></i><b>11.5</b> Centering variables</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="lecture-04.html"><a href="lecture-04.html"><i class="fa fa-check"></i><b>12</b> Lecture 04</a>
<ul>
<li class="chapter" data-level="12.1" data-path="lecture-04.html"><a href="lecture-04.html#standardizing-variables"><i class="fa fa-check"></i><b>12.1</b> Standardizing variables</a></li>
<li class="chapter" data-level="12.2" data-path="lecture-04.html"><a href="lecture-04.html#plotting-uncertainty---sample-from-posterior"><i class="fa fa-check"></i><b>12.2</b> Plotting uncertainty - sample from posterior</a></li>
<li class="chapter" data-level="12.3" data-path="lecture-04.html"><a href="lecture-04.html#polynomials"><i class="fa fa-check"></i><b>12.3</b> Polynomials</a></li>
<li class="chapter" data-level="12.4" data-path="lecture-04.html"><a href="lecture-04.html#splines"><i class="fa fa-check"></i><b>12.4</b> Splines</a></li>
<li class="chapter" data-level="12.5" data-path="lecture-04.html"><a href="lecture-04.html#basis-splines"><i class="fa fa-check"></i><b>12.5</b> Basis splines</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="lecture-04.html"><a href="lecture-04.html#recipe"><i class="fa fa-check"></i><b>12.5.1</b> Recipe</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="lecture-05.html"><a href="lecture-05.html"><i class="fa fa-check"></i><b>13</b> Lecture 05</a>
<ul>
<li class="chapter" data-level="13.1" data-path="lecture-05.html"><a href="lecture-05.html#multiple-regression-models"><i class="fa fa-check"></i><b>13.1</b> Multiple regression models</a></li>
<li class="chapter" data-level="13.2" data-path="lecture-05.html"><a href="lecture-05.html#directed-acyclic-graphs-dag"><i class="fa fa-check"></i><b>13.2</b> Directed acyclic graphs (DAG)</a></li>
<li class="chapter" data-level="13.3" data-path="lecture-05.html"><a href="lecture-05.html#example-age-marriage-divorce"><i class="fa fa-check"></i><b>13.3</b> Example: Age, marriage, divorce</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="lecture-05.html"><a href="lecture-05.html#priors-2"><i class="fa fa-check"></i><b>13.3.1</b> Priors</a></li>
<li class="chapter" data-level="13.3.2" data-path="lecture-05.html"><a href="lecture-05.html#prior-predictive-simulation-2"><i class="fa fa-check"></i><b>13.3.2</b> Prior predictive simulation</a></li>
<li class="chapter" data-level="13.3.3" data-path="lecture-05.html"><a href="lecture-05.html#interpretation-5"><i class="fa fa-check"></i><b>13.3.3</b> Interpretation</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="lecture-05.html"><a href="lecture-05.html#plotting-multivariate-posteriors"><i class="fa fa-check"></i><b>13.4</b> Plotting multivariate posteriors</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="lecture-05.html"><a href="lecture-05.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>13.4.1</b> Posterior predictive checks</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="lecture-05.html"><a href="lecture-05.html#reveal-masked-associations"><i class="fa fa-check"></i><b>13.5</b> Reveal masked associations</a></li>
<li class="chapter" data-level="13.6" data-path="lecture-05.html"><a href="lecture-05.html#categorical-variables"><i class="fa fa-check"></i><b>13.6</b> Categorical variables</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="lecture-05.html"><a href="lecture-05.html#dummy-variable"><i class="fa fa-check"></i><b>13.6.1</b> Dummy variable</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="lecture-06.html"><a href="lecture-06.html"><i class="fa fa-check"></i><b>14</b> Lecture 06</a>
<ul>
<li class="chapter" data-level="14.1" data-path="lecture-06.html"><a href="lecture-06.html#index-variable"><i class="fa fa-check"></i><b>14.1</b> Index variable</a></li>
<li class="chapter" data-level="14.2" data-path="lecture-06.html"><a href="lecture-06.html#four-elemental-confounds"><i class="fa fa-check"></i><b>14.2</b> Four elemental confounds</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="lecture-06.html"><a href="lecture-06.html#notes"><i class="fa fa-check"></i><b>14.2.1</b> Notes</a></li>
<li class="chapter" data-level="14.2.2" data-path="lecture-06.html"><a href="lecture-06.html#the-fork"><i class="fa fa-check"></i><b>14.2.2</b> The fork</a></li>
<li class="chapter" data-level="14.2.3" data-path="lecture-06.html"><a href="lecture-06.html#the-path"><i class="fa fa-check"></i><b>14.2.3</b> The path</a></li>
<li class="chapter" data-level="14.2.4" data-path="lecture-06.html"><a href="lecture-06.html#the-collider"><i class="fa fa-check"></i><b>14.2.4</b> The collider</a></li>
<li class="chapter" data-level="14.2.5" data-path="lecture-06.html"><a href="lecture-06.html#steps"><i class="fa fa-check"></i><b>14.2.5</b> Steps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="lecture-07.html"><a href="lecture-07.html"><i class="fa fa-check"></i><b>15</b> Lecture 07</a>
<ul>
<li class="chapter" data-level="15.1" data-path="lecture-07.html"><a href="lecture-07.html#four-elemental-confounds-continued"><i class="fa fa-check"></i><b>15.1</b> Four elemental confounds (continued)</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="lecture-07.html"><a href="lecture-07.html#unobserved-variables"><i class="fa fa-check"></i><b>15.1.1</b> Unobserved variables</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="lecture-07.html"><a href="lecture-07.html#over-fitting"><i class="fa fa-check"></i><b>15.2</b> Over fitting</a></li>
<li class="chapter" data-level="15.3" data-path="lecture-07.html"><a href="lecture-07.html#measuring-model-fit"><i class="fa fa-check"></i><b>15.3</b> Measuring model fit</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="lecture-07.html"><a href="lecture-07.html#r-squared"><i class="fa fa-check"></i><b>15.3.1</b> R squared</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="lecture-07.html"><a href="lecture-07.html#obtaining-the-regular-features"><i class="fa fa-check"></i><b>15.4</b> Obtaining the regular features</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="lecture-08.html"><a href="lecture-08.html"><i class="fa fa-check"></i><b>16</b> Lecture 08</a>
<ul>
<li class="chapter" data-level="16.1" data-path="lecture-08.html"><a href="lecture-08.html#information-theory"><i class="fa fa-check"></i><b>16.1</b> Information theory</a></li>
<li class="chapter" data-level="16.2" data-path="lecture-08.html"><a href="lecture-08.html#divergence"><i class="fa fa-check"></i><b>16.2</b> Divergence</a></li>
<li class="chapter" data-level="16.3" data-path="lecture-08.html"><a href="lecture-08.html#estimating-divergence"><i class="fa fa-check"></i><b>16.3</b> Estimating divergence</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="lecture-08.html"><a href="lecture-08.html#log-pointwise-predictive-density"><i class="fa fa-check"></i><b>16.3.1</b> Log pointwise predictive density</a></li>
<li class="chapter" data-level="16.3.2" data-path="lecture-08.html"><a href="lecture-08.html#deviance"><i class="fa fa-check"></i><b>16.3.2</b> Deviance</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="lecture-08.html"><a href="lecture-08.html#regularization"><i class="fa fa-check"></i><b>16.4</b> Regularization</a></li>
<li class="chapter" data-level="16.5" data-path="lecture-08.html"><a href="lecture-08.html#cross-validation"><i class="fa fa-check"></i><b>16.5</b> Cross validation</a>
<ul>
<li class="chapter" data-level="16.5.1" data-path="lecture-08.html"><a href="lecture-08.html#loo"><i class="fa fa-check"></i><b>16.5.1</b> LOO</a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="lecture-08.html"><a href="lecture-08.html#information-criteria"><i class="fa fa-check"></i><b>16.6</b> Information criteria</a>
<ul>
<li class="chapter" data-level="16.6.1" data-path="lecture-08.html"><a href="lecture-08.html#waic"><i class="fa fa-check"></i><b>16.6.1</b> WAIC</a></li>
<li class="chapter" data-level="16.6.2" data-path="lecture-08.html"><a href="lecture-08.html#standard-error"><i class="fa fa-check"></i><b>16.6.2</b> Standard error</a></li>
</ul></li>
<li class="chapter" data-level="16.7" data-path="lecture-08.html"><a href="lecture-08.html#model-selection"><i class="fa fa-check"></i><b>16.7</b> Model selection</a></li>
<li class="chapter" data-level="16.8" data-path="lecture-08.html"><a href="lecture-08.html#model-comparison"><i class="fa fa-check"></i><b>16.8</b> Model comparison</a>
<ul>
<li class="chapter" data-level="16.8.1" data-path="lecture-08.html"><a href="lecture-08.html#example-1-model-mis-selection-using-waic"><i class="fa fa-check"></i><b>16.8.1</b> Example 1: model mis-selection using WAIC</a></li>
<li class="chapter" data-level="16.8.2" data-path="lecture-08.html"><a href="lecture-08.html#example-2-primate-lifetime"><i class="fa fa-check"></i><b>16.8.2</b> Example 2: primate lifetime</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="lecture-09.html"><a href="lecture-09.html"><i class="fa fa-check"></i><b>17</b> Lecture 09</a>
<ul>
<li class="chapter" data-level="17.1" data-path="lecture-09.html"><a href="lecture-09.html#conditioning"><i class="fa fa-check"></i><b>17.1</b> Conditioning</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="lecture-09.html"><a href="lecture-09.html#example-ruggedness"><i class="fa fa-check"></i><b>17.1.1</b> Example: ruggedness</a></li>
<li class="chapter" data-level="17.1.2" data-path="lecture-09.html"><a href="lecture-09.html#example-tulips"><i class="fa fa-check"></i><b>17.1.2</b> Example: tulips</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="lecture-09.html"><a href="lecture-09.html#interpreting-interactions"><i class="fa fa-check"></i><b>17.2</b> Interpreting interactions</a></li>
<li class="chapter" data-level="17.3" data-path="lecture-09.html"><a href="lecture-09.html#plotting-interactions"><i class="fa fa-check"></i><b>17.3</b> Plotting interactions</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="lecture-09.html"><a href="lecture-09.html#higher-order-interactions"><i class="fa fa-check"></i><b>17.3.1</b> Higher order interactions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="lecture-10.html"><a href="lecture-10.html"><i class="fa fa-check"></i><b>18</b> Lecture 10</a>
<ul>
<li class="chapter" data-level="18.1" data-path="lecture-10.html"><a href="lecture-10.html#markov-chain-monte-carlo"><i class="fa fa-check"></i><b>18.1</b> Markov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="18.1.1" data-path="lecture-10.html"><a href="lecture-10.html#metropolis-algorithm"><i class="fa fa-check"></i><b>18.1.1</b> Metropolis algorithm</a></li>
<li class="chapter" data-level="18.1.2" data-path="lecture-10.html"><a href="lecture-10.html#metropolis-hastings"><i class="fa fa-check"></i><b>18.1.2</b> Metropolis Hastings</a></li>
<li class="chapter" data-level="18.1.3" data-path="lecture-10.html"><a href="lecture-10.html#gibbs-sampling"><i class="fa fa-check"></i><b>18.1.3</b> Gibbs sampling</a></li>
<li class="chapter" data-level="18.1.4" data-path="lecture-10.html"><a href="lecture-10.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>18.1.4</b> Hamiltonian Monte Carlo</a></li>
<li class="chapter" data-level="18.1.5" data-path="lecture-10.html"><a href="lecture-10.html#tuning-mcmc"><i class="fa fa-check"></i><b>18.1.5</b> Tuning MCMC</a></li>
<li class="chapter" data-level="18.1.6" data-path="lecture-10.html"><a href="lecture-10.html#stan"><i class="fa fa-check"></i><b>18.1.6</b> Stan</a></li>
<li class="chapter" data-level="18.1.7" data-path="lecture-10.html"><a href="lecture-10.html#ulam"><i class="fa fa-check"></i><b>18.1.7</b> ulam</a></li>
<li class="chapter" data-level="18.1.8" data-path="lecture-10.html"><a href="lecture-10.html#diagnosis"><i class="fa fa-check"></i><b>18.1.8</b> Diagnosis</a></li>
<li class="chapter" data-level="18.1.9" data-path="lecture-10.html"><a href="lecture-10.html#checking-the-chain"><i class="fa fa-check"></i><b>18.1.9</b> Checking the chain</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="lecture-11.html"><a href="lecture-11.html"><i class="fa fa-check"></i><b>19</b> Lecture 11</a>
<ul>
<li class="chapter" data-level="19.1" data-path="lecture-11.html"><a href="lecture-11.html#maximum-entropy"><i class="fa fa-check"></i><b>19.1</b> Maximum entropy</a>
<ul>
<li class="chapter" data-level="19.1.1" data-path="lecture-11.html"><a href="lecture-11.html#distributions"><i class="fa fa-check"></i><b>19.1.1</b> Distributions</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="lecture-11.html"><a href="lecture-11.html#generalized-linear-model"><i class="fa fa-check"></i><b>19.2</b> Generalized linear model</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="lecture-11.html"><a href="lecture-11.html#picking-a-distribution"><i class="fa fa-check"></i><b>19.2.1</b> Picking a distribution</a></li>
<li class="chapter" data-level="19.2.2" data-path="lecture-11.html"><a href="lecture-11.html#types-of-outcomes"><i class="fa fa-check"></i><b>19.2.2</b> Types of outcomes</a></li>
<li class="chapter" data-level="19.2.3" data-path="lecture-11.html"><a href="lecture-11.html#model-parameters-with-a-link-function"><i class="fa fa-check"></i><b>19.2.3</b> Model parameters with a link function</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="lecture-11.html"><a href="lecture-11.html#binomial-distribution"><i class="fa fa-check"></i><b>19.3</b> Binomial distribution</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="lecture-11.html"><a href="lecture-11.html#link"><i class="fa fa-check"></i><b>19.3.1</b> Link</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="lecture-12.html"><a href="lecture-12.html"><i class="fa fa-check"></i><b>20</b> Lecture 12</a>
<ul>
<li class="chapter" data-level="20.1" data-path="lecture-12.html"><a href="lecture-12.html#relative-and-absolute-effects"><i class="fa fa-check"></i><b>20.1</b> Relative and absolute effects</a></li>
<li class="chapter" data-level="20.2" data-path="lecture-12.html"><a href="lecture-12.html#logistic-regression"><i class="fa fa-check"></i><b>20.2</b> Logistic regression</a></li>
<li class="chapter" data-level="20.3" data-path="lecture-12.html"><a href="lecture-12.html#simpsons-paradox"><i class="fa fa-check"></i><b>20.3</b> Simpsons paradox</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="lecture-13.html"><a href="lecture-13.html"><i class="fa fa-check"></i><b>21</b> Lecture 13</a>
<ul>
<li class="chapter" data-level="21.1" data-path="lecture-13.html"><a href="lecture-13.html#binomial"><i class="fa fa-check"></i><b>21.1</b> Binomial</a></li>
<li class="chapter" data-level="21.2" data-path="lecture-13.html"><a href="lecture-13.html#poisson"><i class="fa fa-check"></i><b>21.2</b> Poisson</a></li>
<li class="chapter" data-level="21.3" data-path="lecture-13.html"><a href="lecture-13.html#generalized-linear-madness"><i class="fa fa-check"></i><b>21.3</b> Generalized linear madness</a></li>
<li class="chapter" data-level="21.4" data-path="lecture-13.html"><a href="lecture-13.html#scientific-model"><i class="fa fa-check"></i><b>21.4</b> Scientific model</a></li>
<li class="chapter" data-level="21.5" data-path="lecture-13.html"><a href="lecture-13.html#survival-analysis"><i class="fa fa-check"></i><b>21.5</b> Survival analysis</a></li>
<li class="chapter" data-level="21.6" data-path="lecture-13.html"><a href="lecture-13.html#monsters"><i class="fa fa-check"></i><b>21.6</b> Monsters</a></li>
<li class="chapter" data-level="21.7" data-path="lecture-13.html"><a href="lecture-13.html#mixtures"><i class="fa fa-check"></i><b>21.7</b> Mixtures</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="lecture-14.html"><a href="lecture-14.html"><i class="fa fa-check"></i><b>22</b> Lecture 14</a>
<ul>
<li class="chapter" data-level="22.1" data-path="lecture-14.html"><a href="lecture-14.html#ordered-categories"><i class="fa fa-check"></i><b>22.1</b> Ordered categories</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="lecture-15.html"><a href="lecture-15.html"><i class="fa fa-check"></i><b>23</b> Lecture 15</a>
<ul>
<li class="chapter" data-level="23.1" data-path="lecture-15.html"><a href="lecture-15.html#multilevel-models"><i class="fa fa-check"></i><b>23.1</b> Multilevel models</a></li>
<li class="chapter" data-level="23.2" data-path="lecture-15.html"><a href="lecture-15.html#varying-intercepts"><i class="fa fa-check"></i><b>23.2</b> Varying intercepts</a></li>
<li class="chapter" data-level="23.3" data-path="lecture-15.html"><a href="lecture-15.html#shrinkage"><i class="fa fa-check"></i><b>23.3</b> Shrinkage</a></li>
<li class="chapter" data-level="23.4" data-path="lecture-15.html"><a href="lecture-15.html#pooling"><i class="fa fa-check"></i><b>23.4</b> Pooling</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Learning bayesian data analysis with Statistical Rethinking</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="homework-week-5" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Homework: Week 5</h1>
<p>2021-09-03 [updated: 2021-09-08]</p>
<div id="setup-2" class="section level3" number="6.0.1">
<h3><span class="header-section-number">6.0.1</span> Setup</h3>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="homework-week-5.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages</span></span>
<span id="cb71-2"><a href="homework-week-5.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdag)</span>
<span id="cb71-3"><a href="homework-week-5.html#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb71-4"><a href="homework-week-5.html#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb71-5"><a href="homework-week-5.html#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb71-6"><a href="homework-week-5.html#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb71-7"><a href="homework-week-5.html#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="homework-week-5.html#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Functions</span></span>
<span id="cb71-9"><a href="homework-week-5.html#cb71-9" aria-hidden="true" tabindex="-1"></a>dag_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(dag) {</span>
<span id="cb71-10"><a href="homework-week-5.html#cb71-10" aria-hidden="true" tabindex="-1"></a>    stat <span class="ot">&lt;-</span> <span class="fu">node_status</span>(dag, <span class="cn">FALSE</span>)</span>
<span id="cb71-11"><a href="homework-week-5.html#cb71-11" aria-hidden="true" tabindex="-1"></a>    stat<span class="sc">$</span>data<span class="sc">$</span>status[<span class="fu">is.na</span>(stat<span class="sc">$</span>data<span class="sc">$</span>status)] <span class="ot">&lt;-</span> <span class="st">&#39;intermediate&#39;</span></span>
<span id="cb71-12"><a href="homework-week-5.html#cb71-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(stat, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb71-13"><a href="homework-week-5.html#cb71-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> status), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb71-14"><a href="homework-week-5.html#cb71-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_dag_edges</span>() <span class="sc">+</span></span>
<span id="cb71-15"><a href="homework-week-5.html#cb71-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&#39;&#39;</span>) <span class="sc">+</span> </span>
<span id="cb71-16"><a href="homework-week-5.html#cb71-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_dag_text</span>(<span class="at">color =</span> <span class="st">&#39;black&#39;</span>) <span class="sc">+</span></span>
<span id="cb71-17"><a href="homework-week-5.html#cb71-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">list</span>(<span class="st">&#39;exposure&#39;</span> <span class="ot">=</span> <span class="st">&#39;#35608DFF&#39;</span>,</span>
<span id="cb71-18"><a href="homework-week-5.html#cb71-18" aria-hidden="true" tabindex="-1"></a>                                                                         <span class="st">&#39;outcome&#39;</span> <span class="ot">=</span> <span class="st">&#39;#22A884FF&#39;</span>,</span>
<span id="cb71-19"><a href="homework-week-5.html#cb71-19" aria-hidden="true" tabindex="-1"></a>                                                                         <span class="st">&#39;intermediate&#39;</span> <span class="ot">=</span> <span class="st">&#39;grey50&#39;</span>)) <span class="sc">+</span> </span>
<span id="cb71-20"><a href="homework-week-5.html#cb71-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_void</span>()</span>
<span id="cb71-21"><a href="homework-week-5.html#cb71-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-22"><a href="homework-week-5.html#cb71-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-23"><a href="homework-week-5.html#cb71-23" aria-hidden="true" tabindex="-1"></a>cmd_draws <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb71-24"><a href="homework-week-5.html#cb71-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_draws_df</span>(model<span class="sc">$</span><span class="fu">draws</span>())</span>
<span id="cb71-25"><a href="homework-week-5.html#cb71-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-1-4" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Question 1</h2>
<blockquote>
<p>Consider the <code>data(Wines2012)</code> data table. These data are expert ratings of 20
different French and American wines by 9 different French and American judges.</p>
</blockquote>
<div id="data-2" class="section level3" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Data</h3>
<blockquote>
<p>Your goal is to model score, the subjective rating assigned by each judge to
each wine. I recommend standardizing it. In this first problem, consider only
variation among judges and wines. Construct index variables of judge and wine
and then use these index variables to construct a linear regression model.</p>
</blockquote>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="homework-week-5.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb72-2"><a href="homework-week-5.html#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb72-3"><a href="homework-week-5.html#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb72-4"><a href="homework-week-5.html#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb72-5"><a href="homework-week-5.html#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb72-6"><a href="homework-week-5.html#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="homework-week-5.html#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Wines2012&quot;</span>)</span>
<span id="cb72-8"><a href="homework-week-5.html#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="homework-week-5.html#cb72-9" aria-hidden="true" tabindex="-1"></a>DT <span class="ot">&lt;-</span> <span class="fu">data.table</span>(Wines2012)</span>
<span id="cb72-10"><a href="homework-week-5.html#cb72-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-11"><a href="homework-week-5.html#cb72-11" aria-hidden="true" tabindex="-1"></a>DT[, scale_score <span class="sc">:</span><span class="er">=</span> <span class="fu">scale</span>(score)]</span>
<span id="cb72-12"><a href="homework-week-5.html#cb72-12" aria-hidden="true" tabindex="-1"></a>DT[, index_judge <span class="sc">:</span><span class="er">=</span> .GRP, judge]</span>
<span id="cb72-13"><a href="homework-week-5.html#cb72-13" aria-hidden="true" tabindex="-1"></a>DT[, index_wine <span class="sc">:</span><span class="er">=</span> .GRP, wine]</span>
<span id="cb72-14"><a href="homework-week-5.html#cb72-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-15"><a href="homework-week-5.html#cb72-15" aria-hidden="true" tabindex="-1"></a>n_index_judge <span class="ot">&lt;-</span> DT[, <span class="fu">uniqueN</span>(index_judge)]</span>
<span id="cb72-16"><a href="homework-week-5.html#cb72-16" aria-hidden="true" tabindex="-1"></a>n_index_wine <span class="ot">&lt;-</span> DT[, <span class="fu">uniqueN</span>(index_wine)]</span>
<span id="cb72-17"><a href="homework-week-5.html#cb72-17" aria-hidden="true" tabindex="-1"></a>n_rows <span class="ot">&lt;-</span> DT[, .N]</span></code></pre></div>
</div>
<div id="prior-predictive-simulation-1" class="section level3" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Prior predictive simulation</h3>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="homework-week-5.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">register_knitr_engine</span>(<span class="at">override =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre class="stan"><code>data {
  int&lt;lower=0&gt; N;
  int&lt;lower=0&gt; N_judges;
  int&lt;lower=0&gt; N_wines;
}
parameters{
  real alpha;
  vector[N_judges] beta_judge;
  vector[N_wines] beta_wine;
  real&lt;lower=0&gt; sigma;
}
model{
  sigma ~ exponential(1);
  beta_wine ~ normal(0, 0.5);
  beta_judge~normal(0, 0.5);
  alpha~normal(0, 0.2);
}</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="homework-week-5.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># q1_stan &lt;- &#39;q1_prior.stan&#39;</span></span>
<span id="cb75-2"><a href="homework-week-5.html#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="co"># writeLines(readLines(q1_stan))</span></span>
<span id="cb75-3"><a href="homework-week-5.html#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co"># q1_prior &lt;- cmdstan_model(q1_stan)</span></span>
<span id="cb75-4"><a href="homework-week-5.html#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="homework-week-5.html#cb75-5" aria-hidden="true" tabindex="-1"></a>q1_prior_sample <span class="ot">&lt;-</span> q1_prior<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb75-6"><a href="homework-week-5.html#cb75-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">list</span>(<span class="at">N =</span> n_rows,</span>
<span id="cb75-7"><a href="homework-week-5.html#cb75-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">N_judges =</span> n_index_judge,</span>
<span id="cb75-8"><a href="homework-week-5.html#cb75-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">N_wines =</span> n_index_wine)</span>
<span id="cb75-9"><a href="homework-week-5.html#cb75-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running MCMC with 4 sequential chains...
## 
## Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 1 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 1 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 1 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 1 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 1 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 1 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 1 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 1 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 1 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 1 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 1 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 1 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 1 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 1 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 1 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 1 finished in 0.1 seconds.
## Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 2 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 2 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 2 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 2 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 2 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 2 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 2 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 2 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 2 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 2 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 2 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 2 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 2 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 2 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 2 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 2 finished in 0.1 seconds.
## Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 3 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 3 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 3 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 3 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 3 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 3 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 3 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 3 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 3 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 3 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 3 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 3 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 3 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 3 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 3 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 3 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 3 finished in 0.1 seconds.
## Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 4 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 4 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 4 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 4 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 4 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 4 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 4 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 4 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 4 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 4 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 4 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 4 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 4 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 4 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 4 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 4 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 4 finished in 0.1 seconds.
## 
## All 4 chains finished successfully.
## Mean chain execution time: 0.1 seconds.
## Total execution time: 0.7 seconds.</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="homework-week-5.html#cb77-1" aria-hidden="true" tabindex="-1"></a>q1_prior_draws <span class="ot">&lt;-</span> <span class="fu">cmd_draws</span>(q1_prior_sample)</span>
<span id="cb77-2"><a href="homework-week-5.html#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="homework-week-5.html#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(q1_prior_draws, <span class="at">regex_pars =</span> <span class="st">&#39;judge&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="homework-week-5.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(q1_prior_draws, <span class="at">regex_pars =</span> <span class="st">&#39;wine&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-40-2.png" width="672" /></p>
<blockquote>
<p>Justify your priors. You should end up with 9 judge parameters and 20 wine
parameters.</p>
</blockquote>
<p>Given the parameters are scaled, the prior predictive plots show scaled wine scores mostly between -2 and 2. Since we do not have any prior knowledge about how this relationship (positive/negative slopes), we are satisfied with this
relatively conservative prior.</p>
</div>
<div id="model-2" class="section level3" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> Model</h3>
<blockquote>
<p>Use ulam instead of quap to build this model, and be sure to check
the chains for convergence. If you’d rather build the model directly in Stan or
PyMC3, go ahead. I just want you to use Hamiltonian Monte Carlo instead of
quadratic approximation.</p>
</blockquote>
<pre class="stan"><code>data {
  int&lt;lower=0&gt; N;
  int&lt;lower=0&gt; N_judges;
  int&lt;lower=0&gt; N_wines;
  int index_judge[N];
  int index_wine[N];
  vector[N] scale_score;
}
parameters{
  real alpha;
  vector[N_judges] beta_judge;
  vector[N_wines] beta_wine;
  real&lt;lower=0&gt; sigma;
}
model{
  alpha ~ normal(0, 0.2);
  beta_wine ~ normal(0, 0.5);
  beta_judge ~ normal(0, 0.5);
  sigma ~ exponential(1);

  vector[N] mu;
  mu = beta_wine[index_wine] + beta_judge[index_judge];
  scale_score ~ normal(mu, sigma);
}</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="homework-week-5.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># q1_stan &lt;- &#39;q1.stan&#39;</span></span>
<span id="cb80-2"><a href="homework-week-5.html#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co"># writeLines(readLines(q1_stan))</span></span>
<span id="cb80-3"><a href="homework-week-5.html#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co"># q1_model &lt;- cmdstan_model(q1_stan)</span></span>
<span id="cb80-4"><a href="homework-week-5.html#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="homework-week-5.html#cb80-5" aria-hidden="true" tabindex="-1"></a>q1_sample <span class="ot">&lt;-</span> q1_model<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb80-6"><a href="homework-week-5.html#cb80-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">list</span>(<span class="at">N =</span> n_rows,</span>
<span id="cb80-7"><a href="homework-week-5.html#cb80-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">N_judges =</span> n_index_judge,</span>
<span id="cb80-8"><a href="homework-week-5.html#cb80-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">N_wines =</span> n_index_wine,</span>
<span id="cb80-9"><a href="homework-week-5.html#cb80-9" aria-hidden="true" tabindex="-1"></a>                            <span class="at">scale_score =</span> DT[, <span class="fu">as.numeric</span>(scale_score)],</span>
<span id="cb80-10"><a href="homework-week-5.html#cb80-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">index_judge =</span> DT[, index_judge],</span>
<span id="cb80-11"><a href="homework-week-5.html#cb80-11" aria-hidden="true" tabindex="-1"></a>                            <span class="at">index_wine =</span> DT[, index_wine]</span>
<span id="cb80-12"><a href="homework-week-5.html#cb80-12" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb80-13"><a href="homework-week-5.html#cb80-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running MCMC with 4 sequential chains...
## 
## Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 1 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 1 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 1 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 1 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 1 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 1 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 1 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 1 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 1 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 1 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 1 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 1 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 1 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 1 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 1 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 1 finished in 0.1 seconds.
## Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 2 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 2 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 2 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 2 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 2 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 2 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 2 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 2 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 2 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 2 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 2 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 2 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 2 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 2 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 2 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 2 finished in 0.1 seconds.
## Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 3 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 3 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 3 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 3 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 3 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 3 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 3 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 3 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 3 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 3 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 3 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 3 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 3 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 3 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 3 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 3 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 3 finished in 0.1 seconds.
## Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 4 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 4 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 4 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 4 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 4 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 4 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 4 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 4 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 4 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 4 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 4 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 4 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 4 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 4 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 4 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 4 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 4 finished in 0.1 seconds.
## 
## All 4 chains finished successfully.
## Mean chain execution time: 0.1 seconds.
## Total execution time: 1.1 seconds.</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="homework-week-5.html#cb82-1" aria-hidden="true" tabindex="-1"></a>q1_draws <span class="ot">&lt;-</span> <span class="fu">cmd_draws</span>(q1_sample)</span>
<span id="cb82-2"><a href="homework-week-5.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setDT</span>(q1_draws)</span></code></pre></div>
<blockquote>
<p>How do you interpret the variation among individual judges and individual
wines? Do you notice any patterns, just by plotting the differences? Which
judges gave the highest/lowest ratings? Which wines were rated worst/ best on
average?</p>
</blockquote>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="homework-week-5.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Judges</span></span>
<span id="cb83-2"><a href="homework-week-5.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(q1_draws, <span class="at">depth =</span> <span class="dv">2</span>)[<span class="dv">3</span><span class="sc">:</span><span class="dv">11</span>,]</span></code></pre></div>
<pre><code>##                mean   sd   5.5%  94.5%       histogram
## beta_judge[1] -0.55 0.19 -0.852 -0.230  ▁▁▁▁▂▃▇▇▇▃▂▁▁▁
## beta_judge[2] -0.35 0.20 -0.663 -0.031  ▁▁▁▂▅▇▇▅▃▂▁▁▁▁
## beta_judge[3]  0.79 0.19  0.486  1.102        ▁▁▃▇▇▂▁▁
## beta_judge[4]  0.12 0.20 -0.192  0.435       ▁▁▁▃▇▅▁▁▁
## beta_judge[5] -0.66 0.20 -0.972 -0.337 ▁▁▁▁▂▅▇▇▇▃▂▁▁▁▁
## beta_judge[6]  0.47 0.20  0.158  0.796 ▁▁▁▁▂▃▇▇▇▅▃▁▁▁▁
## beta_judge[7] -0.28 0.20 -0.601  0.045 ▁▁▁▂▃▅▇▇▇▃▂▁▁▁▁
## beta_judge[8]  0.20 0.19 -0.097  0.505       ▁▁▂▇▇▂▁▁▁
## beta_judge[9]  0.21 0.19 -0.096  0.519        ▁▁▂▇▇▂▁▁</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="homework-week-5.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">melt</span>(q1_draws, <span class="at">measure.vars =</span> <span class="fu">patterns</span>(<span class="st">&#39;beta_judge&#39;</span>))[, .(<span class="at">mean_score =</span> <span class="fu">mean</span>(value)), variable][<span class="fu">order</span>(<span class="sc">-</span>mean_score)]</span></code></pre></div>
<pre><code>##         variable mean_score
##           &lt;fctr&gt;      &lt;num&gt;
## 1: beta_judge[3]       0.79
## 2: beta_judge[6]       0.47
## 3: beta_judge[9]       0.21
## 4: beta_judge[8]       0.20
## 5: beta_judge[4]       0.12
## 6: beta_judge[7]      -0.28
## 7: beta_judge[2]      -0.35
## 8: beta_judge[1]      -0.55
## 9: beta_judge[5]      -0.66</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="homework-week-5.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(q1_draws, <span class="at">regex_pars =</span> <span class="st">&#39;judge&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="homework-week-5.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wines</span></span>
<span id="cb88-2"><a href="homework-week-5.html#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(q1_draws, <span class="at">depth =</span> <span class="dv">2</span>)[<span class="dv">12</span><span class="sc">:</span><span class="dv">31</span>,]</span></code></pre></div>
<pre><code>##                  mean   sd   5.5% 94.5%    histogram
## beta_wine[1]   0.1215 0.27 -0.300  0.55  ▁▁▁▂▅▇▅▂▁▁▁
## beta_wine[2]   0.2304 0.26 -0.194  0.66   ▁▁▁▃▇▇▅▂▁▁
## beta_wine[3]  -0.0964 0.27 -0.528  0.32  ▁▁▁▂▅▇▅▂▁▁▁
## beta_wine[4]   0.2460 0.26 -0.163  0.66   ▁▁▃▇▇▅▂▁▁▁
## beta_wine[5]   0.0715 0.25 -0.326  0.48 ▁▁▁▁▂▅▇▅▂▁▁▁
## beta_wine[6]  -0.0075 0.26 -0.429  0.41   ▁▁▁▃▇▇▃▁▁▁
## beta_wine[7]  -0.0851 0.27 -0.520  0.36  ▁▁▁▂▅▇▅▂▁▁▁
## beta_wine[8]  -0.1789 0.25 -0.578  0.22   ▁▁▁▃▇▇▃▁▁▁
## beta_wine[9]  -0.1191 0.25 -0.516  0.28   ▁▁▁▂▇▇▅▂▁▁
## beta_wine[10] -0.1320 0.26 -0.555  0.28   ▁▁▂▅▇▅▂▁▁▁
## beta_wine[11]  0.0897 0.25 -0.326  0.50  ▁▁▁▂▅▇▅▂▁▁▁
## beta_wine[12]  0.4670 0.26  0.057  0.88  ▁▁▁▂▇▇▅▂▁▁▁
## beta_wine[13] -0.3031 0.26 -0.725  0.12  ▁▁▁▂▅▇▅▂▁▁▁
## beta_wine[14]  0.2277 0.25 -0.177  0.63  ▁▁▁▁▃▇▇▅▂▁▁
## beta_wine[15]  0.1068 0.26 -0.302  0.52   ▁▁▁▂▅▇▅▂▁▁
## beta_wine[16] -0.0188 0.26 -0.453  0.40  ▁▁▂▃▇▇▃▁▁▁▁
## beta_wine[17]  0.0121 0.25 -0.394  0.41   ▁▁▁▃▇▇▃▁▁▁
## beta_wine[18] -0.1655 0.25 -0.565  0.23   ▁▁▁▃▇▇▃▂▁▁
## beta_wine[19] -0.7180 0.26 -1.134 -0.30  ▁▁▂▅▇▅▂▁▁▁▁
## beta_wine[20]  0.3266 0.26 -0.087  0.75  ▁▁▁▂▅▇▇▂▁▁▁</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="homework-week-5.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">melt</span>(q1_draws, <span class="at">measure.vars =</span> <span class="fu">patterns</span>(<span class="st">&#39;beta_wine&#39;</span>))[, .(<span class="at">mean_score =</span> <span class="fu">mean</span>(value)), variable][<span class="fu">order</span>(<span class="sc">-</span>mean_score)]</span></code></pre></div>
<pre><code>##          variable mean_score
##            &lt;fctr&gt;      &lt;num&gt;
##  1: beta_wine[12]     0.4670
##  2: beta_wine[20]     0.3266
##  3:  beta_wine[4]     0.2460
##  4:  beta_wine[2]     0.2304
##  5: beta_wine[14]     0.2277
##  6:  beta_wine[1]     0.1215
##  7: beta_wine[15]     0.1068
##  8: beta_wine[11]     0.0897
##  9:  beta_wine[5]     0.0715
## 10: beta_wine[17]     0.0121
## 11:  beta_wine[6]    -0.0075
## 12: beta_wine[16]    -0.0188
## 13:  beta_wine[7]    -0.0851
## 14:  beta_wine[3]    -0.0964
## 15:  beta_wine[9]    -0.1191
## 16: beta_wine[10]    -0.1320
## 17: beta_wine[18]    -0.1655
## 18:  beta_wine[8]    -0.1789
## 19: beta_wine[13]    -0.3031
## 20: beta_wine[19]    -0.7180
##          variable mean_score</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="homework-week-5.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(q1_draws, <span class="at">regex_pars =</span> <span class="st">&#39;wine&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-43-2.png" width="672" /></p>
<p>Accounting for judges, most wines are scored with similar distributions. Wine 19
however was particularly poorly scored. Judges, however, have much more variable
scoring with three individuals (judges 1, 2, 5) entirely or almost entirely
scoring lower than other judges. The worst scoring judge was judge 5.</p>
</div>
</div>
<div id="question-2-4" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Question 2</h2>
<blockquote>
<p>Now consider three features of the wines and judges: (1) flight: Whether the wine is red or white. (2) wine.amer: Indicator variable for American wines. (3) judge.amer: Indicator variable for American judges. Use indicator or index variables to model the influence of these features on the scores. Omit the individual judge and wine index variables from Problem
1. Do not include interaction effects yet. Again use ulam, justify your priors,
and be sure to check the chains.</p>
</blockquote>
<div id="data-3" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Data</h3>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="homework-week-5.html#cb93-1" aria-hidden="true" tabindex="-1"></a>DT[, scale_score <span class="sc">:</span><span class="er">=</span> <span class="fu">scale</span>(score)]</span>
<span id="cb93-2"><a href="homework-week-5.html#cb93-2" aria-hidden="true" tabindex="-1"></a>DT[, index_flight <span class="sc">:</span><span class="er">=</span> .GRP, flight]</span>
<span id="cb93-3"><a href="homework-week-5.html#cb93-3" aria-hidden="true" tabindex="-1"></a>DT[, index_wine_american <span class="sc">:</span><span class="er">=</span> .GRP, wine.amer]</span>
<span id="cb93-4"><a href="homework-week-5.html#cb93-4" aria-hidden="true" tabindex="-1"></a>DT[, index_judge_american <span class="sc">:</span><span class="er">=</span> .GRP, judge.amer]</span>
<span id="cb93-5"><a href="homework-week-5.html#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="homework-week-5.html#cb93-6" aria-hidden="true" tabindex="-1"></a>n_index_flight <span class="ot">&lt;-</span> DT[, <span class="fu">uniqueN</span>(flight)]</span>
<span id="cb93-7"><a href="homework-week-5.html#cb93-7" aria-hidden="true" tabindex="-1"></a>n_index_wine_american <span class="ot">&lt;-</span> DT[, <span class="fu">uniqueN</span>(index_wine_american)]</span>
<span id="cb93-8"><a href="homework-week-5.html#cb93-8" aria-hidden="true" tabindex="-1"></a>n_index_judge_american <span class="ot">&lt;-</span> DT[, <span class="fu">uniqueN</span>(index_judge_american)]</span>
<span id="cb93-9"><a href="homework-week-5.html#cb93-9" aria-hidden="true" tabindex="-1"></a>n_rows <span class="ot">&lt;-</span> DT[, .N]</span>
<span id="cb93-10"><a href="homework-week-5.html#cb93-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-11"><a href="homework-week-5.html#cb93-11" aria-hidden="true" tabindex="-1"></a>q2_data <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb93-12"><a href="homework-week-5.html#cb93-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.list</span>(DT[, .(<span class="at">scale_score =</span> <span class="fu">as.numeric</span>(scale_score),</span>
<span id="cb93-13"><a href="homework-week-5.html#cb93-13" aria-hidden="true" tabindex="-1"></a>                                 index_flight,</span>
<span id="cb93-14"><a href="homework-week-5.html#cb93-14" aria-hidden="true" tabindex="-1"></a>                                 index_wine_american,</span>
<span id="cb93-15"><a href="homework-week-5.html#cb93-15" aria-hidden="true" tabindex="-1"></a>                                 index_judge_american)]),</span>
<span id="cb93-16"><a href="homework-week-5.html#cb93-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">N_flights =</span> n_index_flight,</span>
<span id="cb93-17"><a href="homework-week-5.html#cb93-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">N_wine_american =</span> n_index_wine_american,</span>
<span id="cb93-18"><a href="homework-week-5.html#cb93-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">N_judge_american =</span> n_index_judge_american,</span>
<span id="cb93-19"><a href="homework-week-5.html#cb93-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> n_rows</span>
<span id="cb93-20"><a href="homework-week-5.html#cb93-20" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="priors" class="section level3" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Priors</h3>
<pre class="stan"><code>data {
  int&lt;lower=0&gt; N;
  int&lt;lower=0&gt; N_flights;
  int&lt;lower=0&gt; N_wine_american;
  int&lt;lower=0&gt; N_judge_american;
}
parameters{
  real alpha;
  vector[N_flights] beta_flights;
  vector[N_wine_american] beta_wine_american;
  vector[N_judge_american] beta_judge_american;
  real&lt;lower=0&gt; sigma;
}
model{
  alpha ~ normal(0, 0.2);
  beta_flights ~ normal(0, 0.5);
  beta_wine_american ~ normal(0, 0.5);
  beta_judge_american ~ normal(0, 0.5);
  sigma ~ exponential(1);
}</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="homework-week-5.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># q2_stan &lt;- &#39;q2_prior.stan&#39;</span></span>
<span id="cb95-2"><a href="homework-week-5.html#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="co"># writeLines(readLines(q2_stan))</span></span>
<span id="cb95-3"><a href="homework-week-5.html#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co"># q2_prior &lt;- cmdstan_model(q2_stan)</span></span>
<span id="cb95-4"><a href="homework-week-5.html#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="homework-week-5.html#cb95-5" aria-hidden="true" tabindex="-1"></a>q2_prior_sample <span class="ot">&lt;-</span> q2_prior<span class="sc">$</span><span class="fu">sample</span>(<span class="at">data =</span> q2_data[<span class="fu">c</span>(<span class="st">&#39;N_flights&#39;</span>,</span>
<span id="cb95-6"><a href="homework-week-5.html#cb95-6" aria-hidden="true" tabindex="-1"></a>                                                                                                        <span class="st">&#39;N_wine_american&#39;</span>,</span>
<span id="cb95-7"><a href="homework-week-5.html#cb95-7" aria-hidden="true" tabindex="-1"></a>                                                                                                        <span class="st">&#39;N_judge_american&#39;</span>,</span>
<span id="cb95-8"><a href="homework-week-5.html#cb95-8" aria-hidden="true" tabindex="-1"></a>                                                                                                        <span class="st">&#39;N&#39;</span>)])</span></code></pre></div>
<pre><code>## Running MCMC with 4 sequential chains...
## 
## Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 1 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 1 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 1 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 1 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 1 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 1 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 1 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 1 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 1 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 1 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 1 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 1 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 1 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 1 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 1 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 1 finished in 0.0 seconds.
## Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 2 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 2 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 2 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 2 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 2 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 2 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 2 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 2 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 2 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 2 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 2 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 2 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 2 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 2 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 2 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 2 finished in 0.0 seconds.
## Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 3 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 3 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 3 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 3 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 3 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 3 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 3 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 3 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 3 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 3 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 3 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 3 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 3 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 3 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 3 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 3 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 3 finished in 0.0 seconds.
## Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 4 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 4 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 4 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 4 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 4 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 4 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 4 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 4 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 4 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 4 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 4 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 4 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 4 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 4 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 4 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 4 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 4 finished in 0.0 seconds.
## 
## All 4 chains finished successfully.
## Mean chain execution time: 0.0 seconds.
## Total execution time: 0.7 seconds.</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="homework-week-5.html#cb97-1" aria-hidden="true" tabindex="-1"></a>q2_prior_draws <span class="ot">&lt;-</span> <span class="fu">cmd_draws</span>(q2_prior_sample)</span>
<span id="cb97-2"><a href="homework-week-5.html#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="homework-week-5.html#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(q2_prior_draws, <span class="at">regex_pars =</span> <span class="st">&#39;flights&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="homework-week-5.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(q2_prior_draws, <span class="at">regex_pars =</span> <span class="st">&#39;judge&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-46-2.png" width="672" /></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="homework-week-5.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(q2_prior_draws, <span class="at">regex_pars =</span> <span class="st">&#39;wine&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-46-3.png" width="672" /></p>
</div>
<div id="model-3" class="section level3" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Model</h3>
<pre class="stan"><code>data {
  int&lt;lower=0&gt; N;
  int&lt;lower=0&gt; N_flights;
  int&lt;lower=0&gt; N_wine_american;
  int&lt;lower=0&gt; N_judge_american;

  int index_flight[N];
  int index_wine_american[N];
  int index_judge_american[N];

  vector[N] scale_score;
}
parameters{
  real alpha;
  vector[N_flights] beta_flights;
  vector[N_wine_american] beta_wine_american;
  vector[N_judge_american] beta_judge_american;
  real&lt;lower=0&gt; sigma;
}
model{
  alpha ~ normal(0, 0.2);
  beta_flights ~ normal(0, 0.5);
  beta_wine_american ~ normal(0, 0.5);
  beta_judge_american ~ normal(0, 0.5);
  sigma ~ exponential(1);

  vector[N] mu;
  mu = beta_flights[index_flight] + beta_wine_american[index_wine_american] + beta_judge_american[index_judge_american];
  scale_score ~ normal(mu, sigma);
}</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="homework-week-5.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># q2_stan &lt;- &#39;q2.stan&#39;</span></span>
<span id="cb101-2"><a href="homework-week-5.html#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="co"># writeLines(readLines(q2_stan))</span></span>
<span id="cb101-3"><a href="homework-week-5.html#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="co"># q2_model &lt;- cmdstan_model(q2_stan)</span></span>
<span id="cb101-4"><a href="homework-week-5.html#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="homework-week-5.html#cb101-5" aria-hidden="true" tabindex="-1"></a>q2_sample <span class="ot">&lt;-</span> q2_model<span class="sc">$</span><span class="fu">sample</span>(<span class="at">data =</span> q2_data)</span></code></pre></div>
<pre><code>## Running MCMC with 4 sequential chains...
## 
## Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 1 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 1 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 1 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 1 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 1 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 1 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 1 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 1 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 1 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 1 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 1 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 1 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 1 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 1 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 1 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 1 finished in 0.4 seconds.
## Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 2 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 2 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 2 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 2 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 2 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 2 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 2 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 2 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 2 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 2 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 2 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 2 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 2 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 2 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 2 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 2 finished in 0.3 seconds.
## Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 3 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 3 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 3 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 3 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 3 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 3 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 3 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 3 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 3 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 3 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 3 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 3 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 3 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 3 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 3 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 3 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 3 finished in 0.4 seconds.
## Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 4 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 4 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 4 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 4 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 4 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 4 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 4 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 4 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 4 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 4 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 4 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 4 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 4 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 4 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 4 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 4 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 4 finished in 0.4 seconds.
## 
## All 4 chains finished successfully.
## Mean chain execution time: 0.4 seconds.
## Total execution time: 1.9 seconds.</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="homework-week-5.html#cb103-1" aria-hidden="true" tabindex="-1"></a>q2_draws <span class="ot">&lt;-</span> <span class="fu">cmd_draws</span>(q2_sample)</span>
<span id="cb103-2"><a href="homework-week-5.html#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="homework-week-5.html#cb103-3" aria-hidden="true" tabindex="-1"></a>q2_sample<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## # A tibble: 9 × 10
##   variable           mean   median     sd    mad      q5     q95  rhat ess_bulk ess_tail
##   &lt;chr&gt;             &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 lp__           -9.24e+1 -9.20e+1 1.99   1.85   -96.1   -89.7    1.00    1558.    1997.
## 2 alpha          -5.97e-3 -2.88e-3 0.196  0.195   -0.326   0.314  1.00    3024.    2617.
## 3 beta_flights[… -6.18e-3 -5.47e-3 0.300  0.291   -0.499   0.477  1.00    1768.    2132.
## 4 beta_flights[… -9.04e-3 -4.49e-3 0.297  0.300   -0.495   0.466  1.00    1844.    1913.
## 5 beta_wine_ame… -9.55e-2 -9.18e-2 0.300  0.295   -0.578   0.396  1.00    2029.    2045.
## 6 beta_wine_ame…  8.90e-2  8.89e-2 0.301  0.296   -0.397   0.586  1.00    1958.    2115.
## 7 beta_judge_am… -1.02e-1 -1.03e-1 0.299  0.297   -0.597   0.386  1.00    1804.    2021.
## 8 beta_judge_am…  1.35e-1  1.33e-1 0.296  0.295   -0.355   0.622  1.00    1808.    1855.
## 9 sigma           1.00e+0  9.98e-1 0.0526 0.0527   0.917   1.09   1.00    3433.    2663.</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="homework-week-5.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(q2_draws)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="homework-week-5.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recall: </span></span>
<span id="cb106-2"><a href="homework-week-5.html#cb106-2" aria-hidden="true" tabindex="-1"></a>DT[, .N, .(flight, index_flight)]</span></code></pre></div>
<pre><code>##    flight index_flight     N
##    &lt;fctr&gt;        &lt;int&gt; &lt;int&gt;
## 1:  white            1    90
## 2:    red            2    90</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="homework-week-5.html#cb108-1" aria-hidden="true" tabindex="-1"></a>DT[, .N, .(judge.amer, index_judge_american)]</span></code></pre></div>
<pre><code>##    judge.amer index_judge_american     N
##         &lt;int&gt;                &lt;int&gt; &lt;int&gt;
## 1:          0                    1    80
## 2:          1                    2   100</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="homework-week-5.html#cb110-1" aria-hidden="true" tabindex="-1"></a>DT[, .N, .(wine.amer, index_wine_american)]</span></code></pre></div>
<pre><code>##    wine.amer index_wine_american     N
##        &lt;int&gt;               &lt;int&gt; &lt;int&gt;
## 1:         1                   1   108
## 2:         0                   2    72</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="homework-week-5.html#cb112-1" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb112-2"><a href="homework-week-5.html#cb112-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;beta_flights[1]&#39;</span> <span class="ot">=</span> <span class="st">&#39;White Wine&#39;</span>,</span>
<span id="cb112-3"><a href="homework-week-5.html#cb112-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;beta_flights[2]&#39;</span> <span class="ot">=</span> <span class="st">&#39;Red Wine&#39;</span>,</span>
<span id="cb112-4"><a href="homework-week-5.html#cb112-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;beta_wine_american[1]&#39;</span> <span class="ot">=</span> <span class="st">&#39;French Wine&#39;</span>,</span>
<span id="cb112-5"><a href="homework-week-5.html#cb112-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;beta_wine_american[2]&#39;</span> <span class="ot">=</span> <span class="st">&#39;American Wine&#39;</span>,</span>
<span id="cb112-6"><a href="homework-week-5.html#cb112-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;beta_judge_american[1]&#39;</span> <span class="ot">=</span> <span class="st">&#39;American Judge&#39;</span>,</span>
<span id="cb112-7"><a href="homework-week-5.html#cb112-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;beta_judge_american[2]&#39;</span> <span class="ot">=</span> <span class="st">&#39;French Judge&#39;</span></span>
<span id="cb112-8"><a href="homework-week-5.html#cb112-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb112-9"><a href="homework-week-5.html#cb112-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(q2_draws, <span class="at">regex_pars =</span> <span class="st">&#39;flight&#39;</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> labs)</span></code></pre></div>
<pre><code>## Scale for &#39;y&#39; is already present. Adding another scale for &#39;y&#39;, which will replace
## the existing scale.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="homework-week-5.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(q2_draws, <span class="at">regex_pars =</span> <span class="st">&#39;judge&#39;</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> labs)</span></code></pre></div>
<pre><code>## Scale for &#39;y&#39; is already present. Adding another scale for &#39;y&#39;, which will replace
## the existing scale.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-49-2.png" width="672" /></p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="homework-week-5.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(q2_draws, <span class="at">regex_pars =</span> <span class="st">&#39;wine&#39;</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> labs)</span></code></pre></div>
<pre><code>## Scale for &#39;y&#39; is already present. Adding another scale for &#39;y&#39;, which will replace
## the existing scale.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-49-3.png" width="672" /></p>
<!-- > What do you conclude about the differences among the wines and judges? Try to -->
<!-- relate the results to the inferences in Problem 1 -->
</div>
</div>
<div id="question-3-3" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Question 3</h2>
<blockquote>
<p>Now consider two-way interactions among the three features. You should end up
with three different interaction terms in your model. These will be easier to
build, if you use indicator variables. Again use ulam, justify your priors, and
be sure to check the chains. Explain what each interaction means. Be sure to
interpret the model’s predictions on the outcome scale (mu, the expected score),
not on the scale of individual parameters. You can use link to help with this,
or just use your knowledge of the linear model instead. What do you conclude
about the features and the scores? Can you relate the results of your model(s)
to the individual judge and wine inferences from Problem 1?</p>
</blockquote>
<div id="data-4" class="section level3" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Data</h3>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="homework-week-5.html#cb118-1" aria-hidden="true" tabindex="-1"></a>DT[, index_interactions <span class="sc">:</span><span class="er">=</span> .GRP, .(judge.amer, wine.amer, flight)]</span>
<span id="cb118-2"><a href="homework-week-5.html#cb118-2" aria-hidden="true" tabindex="-1"></a>n_index_interactions <span class="ot">&lt;-</span> DT[, <span class="fu">uniqueN</span>(index_interactions)]</span>
<span id="cb118-3"><a href="homework-week-5.html#cb118-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-4"><a href="homework-week-5.html#cb118-4" aria-hidden="true" tabindex="-1"></a>q3_data <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb118-5"><a href="homework-week-5.html#cb118-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.list</span>(DT[, .(<span class="at">scale_score =</span> <span class="fu">as.numeric</span>(scale_score),</span>
<span id="cb118-6"><a href="homework-week-5.html#cb118-6" aria-hidden="true" tabindex="-1"></a>                                 index_interactions)]),</span>
<span id="cb118-7"><a href="homework-week-5.html#cb118-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">N_interactions =</span> n_index_interactions,</span>
<span id="cb118-8"><a href="homework-week-5.html#cb118-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> n_rows</span>
<span id="cb118-9"><a href="homework-week-5.html#cb118-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="model-4" class="section level3" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Model</h3>
<pre class="stan"><code>data {
  int&lt;lower=0&gt; N;
  int&lt;lower=0&gt; N_interactions;

  int index_interactions[N];

  vector[N] scale_score;
}
parameters{
  real alpha;
  vector[N_interactions] beta_interactions;
  real&lt;lower=0&gt; sigma;
}
model{
  alpha ~ normal(0, 0.2);
  beta_interactions ~ normal(0, 0.25);
  sigma ~ exponential(1);

  vector[N] mu;
  mu = alpha + beta_interactions[index_interactions];

  scale_score ~ normal(mu, sigma);
}</code></pre>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="homework-week-5.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># q3_stan &lt;- &#39;q3.stan&#39;</span></span>
<span id="cb120-2"><a href="homework-week-5.html#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="co"># writeLines(readLines(q3_stan))</span></span>
<span id="cb120-3"><a href="homework-week-5.html#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="co"># q3_model &lt;- cmdstan_model(q3_stan)</span></span>
<span id="cb120-4"><a href="homework-week-5.html#cb120-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-5"><a href="homework-week-5.html#cb120-5" aria-hidden="true" tabindex="-1"></a>q3_sample <span class="ot">&lt;-</span> q3_model<span class="sc">$</span><span class="fu">sample</span>(<span class="at">data =</span> q3_data)</span></code></pre></div>
<pre><code>## Running MCMC with 4 sequential chains...
## 
## Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 1 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 1 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 1 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 1 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 1 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 1 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 1 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 1 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 1 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 1 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 1 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 1 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 1 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 1 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 1 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling)</code></pre>
<pre><code>## Chain 1 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
<pre><code>## Chain 1 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in &#39;/tmp/Rtmp3UnwGR/model-386a7a2ca522.stan&#39;, line 22, column 2 to column 34)</code></pre>
<pre><code>## Chain 1 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
<pre><code>## Chain 1 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
<pre><code>## Chain 1</code></pre>
<pre><code>## Chain 1 finished in 0.1 seconds.
## Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 2 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 2 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 2 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 2 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 2 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 2 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 2 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 2 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 2 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 2 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 2 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 2 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 2 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 2 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 2 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 2 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling)</code></pre>
<pre><code>## Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
<pre><code>## Chain 2 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in &#39;/tmp/Rtmp3UnwGR/model-386a7a2ca522.stan&#39;, line 22, column 2 to column 34)</code></pre>
<pre><code>## Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
<pre><code>## Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
<pre><code>## Chain 2</code></pre>
<pre><code>## Chain 2 finished in 0.1 seconds.
## Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 3 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 3 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 3 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 3 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 3 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 3 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 3 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 3 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 3 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 3 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 3 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 3 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 3 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 3 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 3 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 3 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 3 finished in 0.1 seconds.
## Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
## Chain 4 Iteration:  100 / 2000 [  5%]  (Warmup) 
## Chain 4 Iteration:  200 / 2000 [ 10%]  (Warmup) 
## Chain 4 Iteration:  300 / 2000 [ 15%]  (Warmup) 
## Chain 4 Iteration:  400 / 2000 [ 20%]  (Warmup) 
## Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) 
## Chain 4 Iteration:  600 / 2000 [ 30%]  (Warmup) 
## Chain 4 Iteration:  700 / 2000 [ 35%]  (Warmup) 
## Chain 4 Iteration:  800 / 2000 [ 40%]  (Warmup) 
## Chain 4 Iteration:  900 / 2000 [ 45%]  (Warmup) 
## Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
## Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
## Chain 4 Iteration: 1100 / 2000 [ 55%]  (Sampling) 
## Chain 4 Iteration: 1200 / 2000 [ 60%]  (Sampling) 
## Chain 4 Iteration: 1300 / 2000 [ 65%]  (Sampling) 
## Chain 4 Iteration: 1400 / 2000 [ 70%]  (Sampling) 
## Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
## Chain 4 Iteration: 1600 / 2000 [ 80%]  (Sampling) 
## Chain 4 Iteration: 1700 / 2000 [ 85%]  (Sampling) 
## Chain 4 Iteration: 1800 / 2000 [ 90%]  (Sampling) 
## Chain 4 Iteration: 1900 / 2000 [ 95%]  (Sampling) 
## Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
## Chain 4 finished in 0.1 seconds.
## 
## All 4 chains finished successfully.
## Mean chain execution time: 0.1 seconds.
## Total execution time: 0.7 seconds.</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="homework-week-5.html#cb134-1" aria-hidden="true" tabindex="-1"></a>q3_draws <span class="ot">&lt;-</span> <span class="fu">cmd_draws</span>(q3_sample)</span>
<span id="cb134-2"><a href="homework-week-5.html#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="homework-week-5.html#cb134-3" aria-hidden="true" tabindex="-1"></a>q3_sample<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## # A tibble: 11 × 10
##    variable         mean   median     sd    mad      q5      q95  rhat ess_bulk ess_tail
##    &lt;chr&gt;           &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1 lp__         -9.25e+1 -9.21e+1 2.23   2.13   -96.6   -89.5     1.00    1753.    2484.
##  2 alpha         5.35e-3  4.70e-3 0.101  0.102   -0.156   0.173   1.00    3148.    3408.
##  3 beta_intera…  2.15e-2  2.25e-2 0.167  0.168   -0.256   0.297   1.00    5505.    3195.
##  4 beta_intera… -1.94e-1 -1.92e-1 0.184  0.183   -0.494   0.104   1.00    5870.    2981.
##  5 beta_intera…  2.49e-2  2.77e-2 0.162  0.164   -0.240   0.293   1.00    4652.    3556.
##  6 beta_intera…  1.05e-1  1.07e-1 0.172  0.171   -0.186   0.384   1.00    6236.    2984.
##  7 beta_intera…  1.28e-1  1.27e-1 0.182  0.180   -0.177   0.424   1.00    6864.    2986.
##  8 beta_intera… -2.57e-1 -2.59e-1 0.171  0.164   -0.538   0.0258  1.00    5519.    2781.
##  9 beta_intera…  1.76e-1  1.73e-1 0.177  0.174   -0.111   0.471   1.00    6247.    2960.
## 10 beta_intera… -1.67e-2 -1.93e-2 0.161  0.164   -0.285   0.244   1.00    5557.    3334.
## 11 sigma         9.92e-1  9.90e-1 0.0516 0.0529   0.912   1.08    1.00    7597.    3479.</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="homework-week-5.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(q3_draws)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="homework-week-5.html#cb137-1" aria-hidden="true" tabindex="-1"></a>DT[, judge_char <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(judge.amer <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&#39;French Judge&#39;</span>, <span class="st">&#39;American Judge&#39;</span>)]</span>
<span id="cb137-2"><a href="homework-week-5.html#cb137-2" aria-hidden="true" tabindex="-1"></a>DT[, wine_char <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(wine.amer <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&#39;French Wine&#39;</span>, <span class="st">&#39;American Wine&#39;</span>)]</span>
<span id="cb137-3"><a href="homework-week-5.html#cb137-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-4"><a href="homework-week-5.html#cb137-4" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> DT[, .(.GRP, <span class="fu">paste</span>(.BY, <span class="at">collapse =</span> <span class="st">&#39;, &#39;</span>)), by <span class="ot">=</span> .(wine_char, judge_char, <span class="fu">as.character</span>(flight))][, .(GRP, V2)]</span>
<span id="cb137-5"><a href="homework-week-5.html#cb137-5" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">setNames</span>(labs<span class="sc">$</span>V2, <span class="fu">paste0</span>(<span class="st">&#39;beta_interactions[&#39;</span>, labs<span class="sc">$</span>GRP, <span class="st">&#39;]&#39;</span>))</span>
<span id="cb137-6"><a href="homework-week-5.html#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(q3_draws, <span class="at">regex_pars =</span> <span class="st">&#39;interaction&#39;</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> labs)</span></code></pre></div>
<pre><code>## Scale for &#39;y&#39; is already present. Adding another scale for &#39;y&#39;, which will replace
## the existing scale.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="homework-week-4.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="homework-week-6.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
