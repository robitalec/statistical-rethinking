---
title: "Week 3"
author: "Alec L. Robitaille"
date: "2021-08-25 [updated: `r Sys.Date()`]"
output: github_document
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rethinking)
```

# Overview

All three problems below are based on the same data. The data in `data(foxes)`
are 116 foxes from 30 different urban groups in England. These foxes are like
street gangs. Group size varies from 2 to 8 individuals. Each group maintains
its own (almost exclusive) urban territory. Some territories are larger than
others. The area variable encodes this information. Some territories also have
more avgfood than others. We want to model the weight of each fox. For the
problems below, assume this DAG


## Setup DAG

```{r dag}
library(ggdag)
library(dagitty)
library(data.table)
library(ggplot2)

dag_plot <- function(dag) {
	stat <- node_status(dag, FALSE)
	stat$data$status[is.na(stat$data$status)] <- 'intermediate'
	ggplot(stat, aes(x = x, y = y, xend = xend, yend = yend)) +
	  geom_dag_point(aes(color = status), alpha = 0.5, size = 15) +
	  geom_dag_edges() +
		labs(color = '') + 
	  geom_dag_text(color = 'black') +
		scale_color_manual(values = list('exposure' = '#35608DFF',
																		 'outcome' = '#22A884FF',
																		 'intermediate' = 'grey50')) + 
	  theme_void()
}

dag <- dagify(
	weight ~ groupsize + avgfood,
	groupsize ~ avgfood,
	avgfood ~ area,
	exposure = 'area',
	outcome = 'weight'
)

dag_plot(dag)
```


# Question 1
Use a model to infer the total causal influence of area on weight. Would
increasing the area available to each fox make it heavier (healthier)? You might
want to standardize the variables. Regardless, use prior predictive simulation
to show that your modelâ€™s prior predictions stay within the possible outcome
range.


## Workings

AREA ON WEIGHT  

scale(weight) ~ dnorm(mu, sigma)  
mu <- a + b * (scale(area))  
a: intercept  
when weight and area are scaled, the expected intercept is 0  
therefore  
a ~ dnorm(0, 0.5)  

b: beta, rate of change given one unit of increase in area  
b ~ dnorm(0, 1)  

sigma: standard deviation  
uniform prior  
sigma ~ dunif(0, 50)  

## Model

```{r}
library(rethinking)

data(foxes)

foxes$scale_area <- scale(foxes$area)
foxes$scale_weight <- scale(foxes$weight)

m1 <- quap(
	alist(
		scale_weight ~ dnorm(mu, sigma),
		mu <- a + bArea * scale_area,
		a ~ dnorm(0, 0.05),
		bArea ~ dnorm(0, 0.5),
		sigma ~ dunif(0, 50)
	), 
	data = foxes
)
```

## Prior predictive simulation

```{r prior_predict_1}
plot_link <- function(DT, n) {
	data.table(DT)[sample(.N, n), 
								 plot(data.table(x = rep(c(-2, 2), .N), 
								 								y = c(V1, V2)),
								 		 type = 'l')]
}

prior <- extract.prior(m)
l <- link(m, post = prior, data = list(scale_area = c(-2, 2)))
plot_link(l, 20)
```
